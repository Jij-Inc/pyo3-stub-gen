# https://taskfile.dev
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  stub-gen:
    desc: Generate stub file
    cmds:
      - cargo run --bin stub_gen

  test:
    desc: Run tests
    cmds:
      - uv sync --dev
      - uv run pyright
      - uvx ruff check
      - uv run mypy --show-error-codes -p hidden_module_docgen_test
      # stubtest is disabled for this example due to PyO3 nested submodule limitations
      # See README.md for details
      - uv run pyrefly check python
      - uv run ty check python

  doc-build:
    desc: Build Sphinx documentation
    deps:
      - stub-gen
    cmds:
      - uv run --with sphinx sphinx-build -W -b html docs docs/_build

  doc-test:
    desc: Test that Sphinx documentation builds and objects.inv exists
    deps:
      - doc-build
    cmds:
      - bash -c 'test -f docs/_build/index.html || (echo "ERROR index.html not generated" && exit 1)'
      - bash -c 'test -f docs/_build/objects.inv || (echo "ERROR objects.inv not generated" && exit 1)'
      - echo "✓ Documentation built successfully"
      - echo "✓ objects.inv generated for intersphinx"
